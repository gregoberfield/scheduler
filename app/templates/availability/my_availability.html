{% extends "base.html" %}

{% block title %}My Availability - WoW TBC{% endblock %}

{% block extra_css %}
<style>
    .date-range-selector {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .quick-fill-buttons {
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="bi bi-calendar-check"></i> My Availability
                <small class="text-muted">- {{ current_user.character_name }}</small>
            </h2>
            
            <!-- Date Range Selector -->
            <div class="date-range-selector">
                <div class="row align-items-end">
                    <div class="col-md-4">
                        <label for="start_date" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="start_date">
                    </div>
                    <div class="col-md-4">
                        <label for="end_date" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="end_date">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" id="load_availability">
                            <i class="bi bi-arrow-clockwise"></i> Load Availability
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Quick Fill Buttons -->
            <div class="quick-fill-buttons">
                <div class="btn-toolbar" role="toolbar">
                    <div class="btn-group me-2" role="group">
                        <button type="button" class="btn btn-outline-secondary" id="select_mode_available">
                            <span class="badge bg-success">&nbsp;&nbsp;&nbsp;</span> Available
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="select_mode_maybe">
                            <span class="badge bg-warning">&nbsp;&nbsp;&nbsp;</span> Maybe
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="select_mode_unavailable">
                            <span class="badge bg-secondary">&nbsp;&nbsp;&nbsp;</span> Unavailable
                        </button>
                    </div>
                    <div class="btn-group me-2" role="group">
                        <button type="button" class="btn btn-outline-primary" id="clear_all">
                            <i class="bi bi-eraser"></i> Clear All
                        </button>
                    </div>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-success" id="save_availability">
                            <i class="bi bi-check-circle"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Current Selection Mode -->
            <div class="alert alert-info" id="current_mode_display">
                Current selection mode: <strong id="current_mode_text">Available</strong>
            </div>
            
            <!-- Timeline Grid -->
            <div id="availability_grid" class="timeline-container">
                <div class="text-center py-5">
                    <p class="text-muted">Select a date range and click "Load Availability" to begin</p>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="card mt-3">
                <div class="card-body">
                    <h6>Legend:</h6>
                    <div class="row">
                        <div class="col-auto">
                            <span class="badge bg-success me-2">&nbsp;&nbsp;&nbsp;</span> Available
                        </div>
                        <div class="col-auto">
                            <span class="badge bg-warning me-2">&nbsp;&nbsp;&nbsp;</span> Maybe
                        </div>
                        <div class="col-auto">
                            <span class="badge bg-secondary me-2">&nbsp;&nbsp;&nbsp;</span> Unavailable
                        </div>
                    </div>
                    <hr>
                    <p class="mb-0"><small><strong>Tip:</strong> Click and drag to select multiple time slots at once</small></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/availability_editor.js') }}"></script>
<script>
    // Initialize with default dates (today + 7 days)
    $(document).ready(function() {
        const today = new Date();
        const weekLater = new Date(today);
        weekLater.setDate(today.getDate() + 7);
        
        $('#start_date').val(today.toISOString().split('T')[0]);
        $('#end_date').val(weekLater.toISOString().split('T')[0]);
    });
</script>
{% endblock %}
